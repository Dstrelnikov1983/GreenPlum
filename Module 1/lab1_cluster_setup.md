# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ1: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ GreenPlum –≤ Yandex Cloud

## –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–ª–∞—Å—Ç–µ—Ä GreenPlum –≤ Yandex MPP Analytics for PostgreSQL, –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –Ω–µ–º—É, –∏–∑—É—á–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ MPP —Å–∏—Å—Ç–µ–º—ã.

## –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**45 –º–∏–Ω—É—Ç** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –ê–∫–∫–∞—É–Ω—Ç –≤ Yandex Cloud (—Ç—Ä–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –ø–æ–¥—Ö–æ–¥–∏—Ç)
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Yandex Cloud CLI
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π PostgreSQL –∫–ª–∏–µ–Ω—Ç (psql)
- –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è SQL –∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
- –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Yandex Cloud Network               ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ Master Host  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§Standby Master‚îÇ    ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ         ‚îÇ              ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ         ‚îÇ                                       ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ    ‚îÇ         ‚îÇ            ‚îÇ             ‚îÇ     ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇSeg 1 ‚îÇ ‚îÇSeg 1 ‚îÇ    ‚îÇSeg 2 ‚îÇ     ‚îÇSeg 2 ‚îÇ  ‚îÇ
‚îÇ ‚îÇPrimary‚îÇ ‚îÇMirror‚îÇ    ‚îÇPrimary‚îÇ     ‚îÇMirror‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ß–∞—Å—Ç—å 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (10 –º–∏–Ω—É—Ç)

### –®–∞–≥ 1.1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Yandex Cloud CLI

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ CLI —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ CLI
yc --version

# –ï—Å–ª–∏ CLI –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
exec -l $SHELL

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CLI (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)
yc init
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í–µ—Ä—Å–∏—è CLI –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 0.100.0 –∏–ª–∏ –≤—ã—à–µ.

### –®–∞–≥ 1.2: –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ (folder) –≤ Yandex Cloud
yc resource-manager folder create --name mpp-lab-folder

# –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞
FOLDER_ID=$(yc resource-manager folder get mpp-lab-folder --format json | jq -r '.id')
echo "Folder ID: $FOLDER_ID"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞
yc config set folder-id $FOLDER_ID
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** 
```bash
yc config list
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å `folder-id` —Å –≤–∞—à–∏–º –Ω–æ–≤—ã–º –∫–∞—Ç–∞–ª–æ–≥–æ–º.

### –®–∞–≥ 1.3: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ VPC —Å–µ—Ç–∏
yc vpc network create \
  --name mpp-network \
  --description "Network for MPP Analytics cluster"

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥—Å–µ—Ç–∏ –≤ –∑–æ–Ω–µ ru-central1-a
yc vpc subnet create \
  --name mpp-subnet-a \
  --network-name mpp-network \
  --zone ru-central1-a \
  --range 10.1.0.0/24

# –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–¥—Å–µ—Ç–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
SUBNET_ID=$(yc vpc subnet get mpp-subnet-a --format json | jq -r '.id')
echo "Subnet ID: $SUBNET_ID"
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
yc vpc network list
yc vpc subnet list
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é —Å–µ—Ç—å `mpp-network` –∏ –ø–æ–¥—Å–µ—Ç—å `mpp-subnet-a`.

### –®–∞–≥ 1.4: –°–æ–∑–¥–∞–Ω–∏–µ security group (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ security group —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
yc vpc security-group create \
  --name mpp-sg \
  --network-name mpp-network \
  --rule "direction=ingress,port=6432,protocol=tcp,v4-cidrs=[0.0.0.0/0]" \
  --rule "direction=egress,protocol=any,v4-cidrs=[0.0.0.0/0]"
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í production –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —Å–ª–µ–¥—É–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö IP –∞–¥—Ä–µ—Å–æ–≤.

## –ß–∞—Å—Ç—å 2: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ GreenPlum (15 –º–∏–Ω—É—Ç)

### –®–∞–≥ 2.1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è (–∏–ª–∏ –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–≤–æ–π)
ADMIN_PASSWORD=$(openssl rand -base64 16)
echo "Admin password: $ADMIN_PASSWORD"

# –í–ê–ñ–ù–û: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ!
```

### –®–∞–≥ 2.2: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ CLI

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
yc managed-greenplum cluster create \
  --name lab-gp-cluster \
  --description "Laboratory GreenPlum cluster for Module 1" \
  --environment production \
  --network-name mpp-network \
  --zone-id ru-central1-a \
  --subnet-id $SUBNET_ID \
  --assign-public-ip \
  --master-config resource-id=s2.medium,disk-size=50,disk-type=network-ssd \
  --segment-config resource-id=s2.medium,disk-size=50,disk-type=network-ssd \
  --segment-host-count 2 \
  --segment-in-host 1 \
  --user-name admin \
  --user-password "$ADMIN_PASSWORD" \
  --greenplum-version "6.25"
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `--name` | lab-gp-cluster | –ò–º—è –∫–ª–∞—Å—Ç–µ—Ä–∞ |
| `--master-config` | s2.medium, 50GB SSD | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Master: 4 vCPU, 16GB RAM |
| `--segment-config` | s2.medium, 50GB SSD | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Segment: 4 vCPU, 16GB RAM |
| `--segment-host-count` | 2 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Ö–æ—Å—Ç–æ–≤ –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤ |
| `--segment-in-host` | 1 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ primary —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Ö–æ—Å—Ç–µ |
| `--assign-public-ip` | true | –ü—É–±–ª–∏—á–Ω—ã–π IP –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑–≤–Ω–µ |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 15-20 –º–∏–Ω—É—Ç.

### –®–∞–≥ 2.3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
yc managed-greenplum cluster get lab-gp-cluster

# –ò–ª–∏ –≤ —Ü–∏–∫–ª–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
watch -n 30 'yc managed-greenplum cluster get lab-gp-cluster --format json | jq -r ".status"'
```

–î–æ–∂–¥–∏—Ç–µ—Å—å —Å—Ç–∞—Ç—É—Å–∞ **RUNNING**.

### –®–∞–≥ 2.4: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ö–æ—Å—Ç–∞—Ö

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞
yc managed-greenplum cluster list-hosts lab-gp-cluster

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ FQDN master —Ö–æ—Å—Ç–∞
MASTER_FQDN=$(yc managed-greenplum cluster list-hosts lab-gp-cluster \
  --format json | jq -r '.[] | select(.type=="MASTER") | .name')
echo "Master FQDN: $MASTER_FQDN"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
+------+--------+---------+---------+----------------+
| NAME | TYPE   | ROLE    | HEALTH  | ZONE           |
+------+--------+---------+---------+----------------+
| ...  | MASTER | PRIMARY | ALIVE   | ru-central1-a  |
| ...  | MASTER | REPLICA | ALIVE   | ru-central1-a  |
| ...  | SEGMENT| PRIMARY | ALIVE   | ru-central1-a  |
| ...  | SEGMENT| REPLICA | ALIVE   | ru-central1-a  |
+------+--------+---------+---------+----------------+
```

## –ß–∞—Å—Ç—å 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É (10 –º–∏–Ω—É—Ç)

### –®–∞–≥ 3.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
mkdir -p ~/.postgresql

# –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ Yandex Cloud
wget "https://storage.yandexcloud.net/cloud-certs/CA.pem" \
  -O ~/.postgresql/root.crt

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
ls -la ~/.postgresql/root.crt
```

### –®–∞–≥ 3.2: –ü–µ—Ä–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ psql

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö postgres (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
psql "host=$MASTER_FQDN \
      port=6432 \
      sslmode=verify-full \
      dbname=postgres \
      user=admin"

# –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Ä–∞–Ω–µ–µ
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (—Å –ø–∞—Ä–æ–ª–µ–º –≤ URL):**
```bash
psql "postgresql://admin:$ADMIN_PASSWORD@$MASTER_FQDN:6432/postgres?sslmode=verify-full"
```

### –®–∞–≥ 3.3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .pgpass –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ .pgpass
echo "$MASTER_FQDN:6432:*:admin:$ADMIN_PASSWORD" >> ~/.pgpass

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
chmod 600 ~/.pgpass

# –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –±–µ–∑ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è
psql "host=$MASTER_FQDN port=6432 dbname=postgres user=admin sslmode=verify-full"
```

### –®–∞–≥ 3.4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ GreenPlum
SELECT version();

-- –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
-- PostgreSQL 9.4.26 (Greenplum Database 6.25.0 build ...)

-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
SELECT current_user, current_database();

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
SELECT count(*) FROM pg_stat_activity;
```

## –ß–∞—Å—Ç—å 4: –ò–∑—É—á–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∫–ª–∞—Å—Ç–µ—Ä–∞ (10 –º–∏–Ω—É—Ç)

### –®–∞–≥ 4.1: –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

```sql
-- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤
SELECT 
    content,
    role,
    preferred_role,
    mode,
    status,
    port,
    hostname,
    address
FROM gp_segment_configuration
ORDER BY content, role;
```

**–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
- `content = -1`: Master —Å–µ–≥–º–µ–Ω—Ç
- `content >= 0`: Data —Å–µ–≥–º–µ–Ω—Ç—ã
- `role = 'p'`: Primary (–∞–∫—Ç–∏–≤–Ω—ã–π) —Å–µ–≥–º–µ–Ω—Ç
- `role = 'm'`: Mirror (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π) —Å–µ–≥–º–µ–Ω—Ç
- `status = 'u'`: Up (—Ä–∞–±–æ—Ç–∞–µ—Ç)

**–í–æ–ø—Ä–æ—Å –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è:** –°–∫–æ–ª—å–∫–æ —É –≤–∞—Å primary —Å–µ–≥–º–µ–Ω—Ç–æ–≤? –°–∫–æ–ª—å–∫–æ mirror?

### –®–∞–≥ 4.2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ primary —Å–µ–≥–º–µ–Ω—Ç–æ–≤
SELECT 
    count(*) as total_segments,
    sum(CASE WHEN role = 'p' THEN 1 ELSE 0 END) as primary_segments,
    sum(CASE WHEN role = 'm' THEN 1 ELSE 0 END) as mirror_segments
FROM gp_segment_configuration
WHERE content >= 0;
```

### –®–∞–≥ 4.3: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö–æ—Å—Ç–∞—Ö

```sql
-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö –Ω–∞ –∫–∞–∂–¥–æ–º —Ö–æ—Å—Ç–µ
SELECT 
    hostname,
    count(*) as segments_count,
    string_agg(content::text, ', ') as segment_ids
FROM gp_segment_configuration
WHERE content >= 0 AND role = 'p'
GROUP BY hostname
ORDER BY hostname;
```

## –ß–∞—Å—Ç—å 5: –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ (10 –º–∏–Ω—É—Ç)

### –®–∞–≥ 5.1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–æ–≤
CREATE DATABASE lab1_test;

-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –Ω–æ–≤–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
\c lab1_test

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
SELECT current_database();
```

### –®–∞–≥ 5.2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å hash distribution

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–æ–¥–∞–∂
CREATE TABLE sales (
    sale_id SERIAL,
    product_id INTEGER NOT NULL,
    customer_id INTEGER NOT NULL,
    sale_date DATE NOT NULL,
    amount NUMERIC(10,2) NOT NULL,
    region VARCHAR(50)
) DISTRIBUTED BY (product_id);

-- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∞–±–ª–∏—Ü–µ
\d+ sales
```

**–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ** –Ω–∞ —Å—Ç—Ä–æ–∫—É `Distributed by: (product_id)`.

### –®–∞–≥ 5.3: –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```sql
-- –í—Å—Ç–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (1000 –∑–∞–ø–∏—Å–µ–π)
INSERT INTO sales (product_id, customer_id, sale_date, amount, region)
SELECT 
    (random() * 100)::integer + 1 as product_id,
    (random() * 1000)::integer + 1 as customer_id,
    current_date - (random() * 365)::integer as sale_date,
    (random() * 1000)::numeric(10,2) as amount,
    CASE (random() * 4)::integer
        WHEN 0 THEN 'North'
        WHEN 1 THEN 'South'
        WHEN 2 THEN 'East'
        ELSE 'West'
    END as region
FROM generate_series(1, 1000);

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π
SELECT count(*) FROM sales;
```

### –®–∞–≥ 5.4: –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º

```sql
-- –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ
SELECT 
    gp_segment_id,
    count(*) as row_count
FROM sales
GROUP BY gp_segment_id
ORDER BY gp_segment_id;
```

**–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
- –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏
- –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π (–≤ –∏–¥–µ–∞–ª–µ < 10%)

### –®–∞–≥ 5.5: –ü—Ä–æ–≤–µ—Ä–∫–∞ parallel execution

```sql
-- –í–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
EXPLAIN ANALYZE
SELECT 
    region,
    count(*) as sales_count,
    sum(amount) as total_amount,
    avg(amount) as avg_amount
FROM sales
GROUP BY region
ORDER BY total_amount DESC;
```

**–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ** –Ω–∞:
- `Gather Motion` - —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- `Slice statistics` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ
- Execution time –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–∞—Ö

### –®–∞–≥ 5.6: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å replicated distribution

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–º–∞–ª–µ–Ω—å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞)
CREATE TABLE products (
    product_id INTEGER PRIMARY KEY,
    product_name VARCHAR(100),
    category VARCHAR(50),
    price NUMERIC(10,2)
) DISTRIBUTED REPLICATED;

-- –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
INSERT INTO products (product_id, product_name, category, price)
SELECT 
    generate_series as product_id,
    'Product ' || generate_series as product_name,
    CASE (random() * 3)::integer
        WHEN 0 THEN 'Electronics'
        WHEN 1 THEN 'Clothing'
        ELSE 'Food'
    END as category,
    (random() * 500 + 10)::numeric(10,2) as price
FROM generate_series(1, 100);

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
SELECT gp_segment_id, count(*) 
FROM products 
GROUP BY gp_segment_id;
```

**–í–æ–ø—Ä–æ—Å:** –ß—Ç–æ –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ replicated —Ç–∞–±–ª–∏—Ü—ã?

### –®–∞–≥ 5.7: JOIN —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π

```sql
-- JOIN –¥–≤—É—Ö —Ç–∞–±–ª–∏—Ü
EXPLAIN ANALYZE
SELECT 
    p.category,
    count(*) as sales_count,
    sum(s.amount) as total_revenue
FROM sales s
JOIN products p ON s.product_id = p.product_id
GROUP BY p.category
ORDER BY total_revenue DESC;
```

**–ê–Ω–∞–ª–∏–∑ –ø–ª–∞–Ω–∞:**
- Replicated —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç redistribution
- JOIN –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ
- –≠—Ç–æ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º redistribute –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü

## –ß–∞—Å—Ç—å 6: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (5 –º–∏–Ω—É—Ç)

### –®–∞–≥ 6.1: –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```sql
-- –¢–µ–∫—É—â–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
SELECT 
    pid,
    usename,
    client_addr,
    query_start,
    state,
    substring(query, 1, 100) as query
FROM pg_stat_activity
WHERE state != 'idle'
ORDER BY query_start;
```

### –®–∞–≥ 6.2: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
SELECT 
    schemaname,
    tablename,
    n_live_tup as row_count,
    n_tup_ins as inserts,
    n_tup_upd as updates,
    n_tup_del as deletes
FROM pg_stat_user_tables
ORDER BY n_live_tup DESC;
```

### –®–∞–≥ 6.3: –†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü

```sql
-- –†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
SELECT 
    schemaname || '.' || tablename as table_name,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size,
    pg_total_relation_size(schemaname||'.'||tablename) as size_bytes
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY size_bytes DESC;
```

### –®–∞–≥ 6.4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –∫–ª–∞—Å—Ç–µ—Ä–∞

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤
SELECT 
    CASE 
        WHEN count(*) = sum(CASE WHEN status = 'u' THEN 1 ELSE 0 END)
        THEN '–ö–ª–∞—Å—Ç–µ—Ä –∑–¥–æ—Ä–æ–≤ - –≤—Å–µ —Å–µ–≥–º–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç'
        ELSE '–í–ù–ò–ú–ê–ù–ò–ï: –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏!'
    END as cluster_health,
    count(*) as total_segments,
    sum(CASE WHEN status = 'u' THEN 1 ELSE 0 END) as up_segments,
    sum(CASE WHEN status = 'd' THEN 1 ELSE 0 END) as down_segments
FROM gp_segment_configuration
WHERE content >= 0;
```

## –ß–∞—Å—Ç—å 7: –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –ø–æ—Å–ª–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π:

```bash
# –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!
yc managed-greenplum cluster delete lab-gp-cluster

# –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
yc vpc subnet delete mpp-subnet-a
yc vpc network delete mpp-network

# –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞
yc resource-manager folder delete mpp-lab-folder
```

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã, –ù–ï —É–¥–∞–ª—è–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä!

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
   - –°–∫–æ–ª—å–∫–æ primary —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –≤ –≤–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ?
   - –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Standby Master?
   - –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –æ–¥–∏–Ω —Å–µ–≥–º–µ–Ω—Ç –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Å—Ç—Ä–æ—è?

2. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
   - –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É DISTRIBUTED BY –∏ DISTRIBUTED REPLICATED?
   - –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é?
   - –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö?

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ü–æ—á–µ–º—É JOIN —Å replicated —Ç–∞–±–ª–∏—Ü–µ–π –±—ã—Å—Ç—Ä–µ–µ?
   - –ö–∞–∫ GreenPlum –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ?
   - –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `gp_segment_id`?

4. **Yandex Cloud:**
   - –í —á–µ–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ managed —Å–µ—Ä–≤–∏—Å–∞?
   - –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä?
   - –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏?

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (–ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)

–ï—Å–ª–∏ –≤—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏ –æ—Å–Ω–æ–≤–Ω—É—é —á–∞—Å—Ç—å —Ä–∞–Ω—å—à–µ:

### –ó–∞–¥–∞–Ω–∏–µ 1: –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç —Å data skew

```sql
-- –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Å –ø–ª–æ—Ö–∏–º distribution key
CREATE TABLE bad_distribution (
    id SERIAL,
    constant_value INTEGER DEFAULT 1,
    data TEXT
) DISTRIBUTED BY (constant_value);

-- –í—Å—Ç–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ
INSERT INTO bad_distribution (data)
SELECT md5(random()::text)
FROM generate_series(1, 10000);

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
SELECT gp_segment_id, count(*) 
FROM bad_distribution 
GROUP BY gp_segment_id;
```

**–í–æ–ø—Ä–æ—Å:** –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ? –ü–æ—á–µ–º—É —ç—Ç–æ –ø–ª–æ—Ö–æ?

### –ó–∞–¥–∞–Ω–∏–µ 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```sql
-- –°–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
CREATE TABLE test_hash AS 
SELECT * FROM sales DISTRIBUTED BY (product_id);

CREATE TABLE test_random AS 
SELECT * FROM sales DISTRIBUTED RANDOMLY;

CREATE TABLE test_replicated AS 
SELECT * FROM sales DISTRIBUTED REPLICATED;

-- –°—Ä–∞–≤–Ω–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å JOIN
EXPLAIN ANALYZE 
SELECT count(*) FROM test_hash t1 JOIN test_hash t2 USING (product_id);

-- –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü
```

### –ó–∞–¥–∞–Ω–∏–µ 3: Monitoring —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
cat > monitor_cluster.sh << 'EOF'
#!/bin/bash
while true; do
    clear
    echo "=== GreenPlum Cluster Monitor ==="
    echo "Time: $(date)"
    echo ""
    
    psql -h $MASTER_FQDN -p 6432 -U admin -d postgres -c "
    SELECT 
        'Active queries: ' || count(*) 
    FROM pg_stat_activity 
    WHERE state = 'active';"
    
    sleep 5
done
EOF

chmod +x monitor_cluster.sh
./monitor_cluster.sh
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤—ã –¥–æ–ª–∂–Ω—ã:

‚úÖ –£–º–µ—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä GreenPlum –≤ Yandex Cloud  
‚úÖ –ü–æ–Ω–∏–º–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Master-Segment  
‚úÖ –ü–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –∫–ª–∞—Å—Ç–µ—Ä—É —á–µ—Ä–µ–∑ psql  
‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è  
‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º  
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å EXPLAIN –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–ª–∞–Ω–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è  
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞  

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Yandex MPP Analytics](https://cloud.yandex.ru/docs/managed-greenplum/)
- [GreenPlum Best Practices](https://docs.vmware.com/en/VMware-Greenplum/index.html)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/9.4/)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–ª–∞—Å—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å Yandex Cloud
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `yc managed-greenplum cluster list-logs lab-gp-cluster`
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—É

---

**–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Ññ1!** üéâ

–¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –º–æ–¥—É–ª—é, –≥–¥–µ –º—ã –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ –∏–∑—É—á–∏–º —Ä–∞–±–æ—Ç—É —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ GreenPlum.
