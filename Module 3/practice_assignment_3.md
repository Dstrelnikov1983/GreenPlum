# –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ3: –ü—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

## –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è

–í —ç—Ç–æ–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–º –∑–∞–¥–∞–Ω–∏–∏ –≤–∞–º –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–º—ã—à–ª–µ–Ω–Ω–æ–π e-commerce –∫–æ–º–ø–∞–Ω–∏–∏ "TechStore".

## –ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç

**TechStore** - –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
- –õ–æ–≥–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (CSV)
- –°–æ–±—ã—Ç–∏—è –æ—Ç –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (JSON)
- –ó–∞–∫–∞–∑—ã –∏–∑ ERP —Å–∏—Å—Ç–µ–º—ã (XML)

–í–∞—à–∞ –∑–∞–¥–∞—á–∞ - —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ GreenPlum –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

## –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**2-3 —á–∞—Å–∞** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Å—Å–∏–π)

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å (70% –æ—Ü–µ–Ω–∫–∏):

1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É CSV, JSON –∏ XML –¥–∞–Ω–Ω—ã—Ö
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å staging –∏ production —Ç–∞–±–ª–∏—Ü—ã
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
4. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
5. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å (30% –æ—Ü–µ–Ω–∫–∏):

6. ‚≠ê –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å –ø–æ–º–æ—â—å—é SQL —Ñ—É–Ω–∫—Ü–∏–π
7. ‚≠ê –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
8. ‚≠ê –°–æ–∑–¥–∞—Ç—å dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
9. ‚≠ê –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
10. ‚≠ê –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ

---

## –ó–∞–¥–∞–Ω–∏–µ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (15 –º–∏–Ω—É—Ç)

### 1.1 –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ö–µ–º

```sql
-- –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
CREATE DATABASE techstore_dwh;
\c techstore_dwh

-- –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å—Ö–µ–º—ã
CREATE SCHEMA staging;     -- –î–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö/—Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
CREATE SCHEMA production;  -- –î–ª—è —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
CREATE SCHEMA audit;       -- –î–ª—è –ª–æ–≥–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ search path
SET search_path = staging, production, audit, public;
```

### 1.2 –°–æ–∑–¥–∞–Ω–∏–µ audit —Ç–∞–±–ª–∏—Ü

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–æ–∫
CREATE TABLE audit.load_history (
    load_id SERIAL PRIMARY KEY,
    table_name TEXT NOT NULL,
    source_file TEXT,
    rows_loaded INTEGER,
    rows_rejected INTEGER,
    load_start TIMESTAMP,
    load_end TIMESTAMP,
    load_duration INTERVAL,
    status TEXT CHECK (status IN ('SUCCESS', 'FAILED', 'PARTIAL')),
    error_message TEXT
) DISTRIBUTED BY (load_id);

-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è data quality –º–µ—Ç—Ä–∏–∫
CREATE TABLE audit.data_quality_checks (
    check_id SERIAL PRIMARY KEY,
    table_name TEXT NOT NULL,
    check_name TEXT NOT NULL,
    check_result TEXT CHECK (check_result IN ('PASS', 'FAIL', 'WARNING')),
    issue_count INTEGER,
    check_details TEXT,
    checked_at TIMESTAMP DEFAULT now()
) DISTRIBUTED BY (check_id);
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–Ω—ã –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, —Å—Ö–µ–º—ã –∏ audit —Ç–∞–±–ª–∏—Ü—ã.

---

## –ó–∞–¥–∞–Ω–∏–µ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (CSV) (25 –º–∏–Ω—É—Ç)

### 2.1 –î–∏–∑–∞–π–Ω —Ç–∞–±–ª–∏—Ü

–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞:

**–ü–æ–ª—è –ª–æ–≥–æ–≤:**
- log_id (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)
- timestamp (–≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞)
- user_id (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –º–æ–∂–µ—Ç –±—ã—Ç—å NULL –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö)
- session_id (ID —Å–µ—Å—Å–∏–∏)
- ip_address (IP –∞–¥—Ä–µ—Å)
- request_method (GET, POST, etc.)
- request_url (URL –∑–∞–ø—Ä–æ—Å–∞)
- response_code (HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥)
- response_time_ms (–≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
- user_agent (–±—Ä–∞—É–∑–µ—Ä/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
- referrer (–æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

```sql
-- Staging —Ç–∞–±–ª–∏—Ü–∞ (–±–µ–∑ constraints)
CREATE TABLE staging.web_logs_staging (
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–¢–†–£–ö–¢–£–†–£ –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    -- –ü–æ–¥—Å–∫–∞–∑–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
    -- –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ PRIMARY KEY –∏ FOREIGN KEY
) DISTRIBUTED BY (?);  -- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–ª—é—á —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

-- Production —Ç–∞–±–ª–∏—Ü–∞ (—Å constraints –∏ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
CREATE TABLE production.web_logs (
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–¢–†–£–ö–¢–£–†–£ –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    -- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
    -- 1. PRIMARY KEY –Ω–∞ log_id
    -- 2. NOT NULL –Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    -- 3. CHECK constraints –Ω–∞ response_code (100-599)
    -- 4. CHECK constraint –Ω–∞ response_time_ms (>= 0)
    -- 5. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ timestamp (–ø–æ –¥–Ω—è–º)
) DISTRIBUTED BY (?)
PARTITION BY RANGE (timestamp)
(
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –ü–ê–†–¢–ò–¶–ò–ò –ù–ê 7 –î–ù–ï–ô
);
```

**–ó–∞–¥–∞–Ω–∏–µ:** 
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∫–ª—é—á —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (DISTRIBUTED BY)
- –û–±–æ—Å–Ω—É–π—Ç–µ —Å–≤–æ–π –≤—ã–±–æ—Ä –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞ 7 –¥–Ω–µ–π

### 2.2 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ CSV —Ñ–∞–π–ª `web_logs_sample.csv` —Å –º–∏–Ω–∏–º—É–º 100 —Å—Ç—Ä–æ–∫–∞–º–∏:

```csv
log_id,timestamp,user_id,session_id,ip_address,request_method,request_url,response_code,response_time_ms,user_agent,referrer
1,2024-11-14 10:00:00,1001,sess_abc123,192.168.1.1,GET,/home,200,45,Mozilla/5.0,https://google.com
2,2024-11-14 10:00:15,NULL,sess_xyz789,192.168.1.2,GET,/products,200,120,Chrome/119.0,,
3,2024-11-14 10:01:00,1002,sess_def456,192.168.1.3,POST,/api/cart,201,89,Safari/17.0,https://site.com/products
...
```

**–ü–æ–¥—Å–∫–∞–∑–∫–∞:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Python/Excel –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 100+ —Å—Ç—Ä–æ–∫ –∏–ª–∏ —Ä–∞—Å—à–∏—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é.

### 2.3 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

```sql
-- –°–æ–∑–¥–∞–π—Ç–µ External Table –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–∑ CSV
CREATE EXTERNAL TABLE staging.ext_web_logs (
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
) LOCATION (?)  -- –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–ª–∏ S3
FORMAT 'CSV' (?);  -- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
CREATE OR REPLACE FUNCTION staging.load_web_logs(
    p_source_file TEXT
) RETURNS TABLE(
    rows_loaded INTEGER,
    rows_rejected INTEGER,
    status TEXT
) AS $$
DECLARE
    v_start_time TIMESTAMP;
    v_end_time TIMESTAMP;
    v_rows_count INTEGER;
    v_reject_count INTEGER;
BEGIN
    v_start_time := clock_timestamp();
    
    -- 1. –û–ß–ò–°–¢–ö–ê STAGING
    TRUNCATE staging.web_logs_staging;
    
    -- 2. –ó–ê–ì–†–£–ó–ö–ê –ò–ó EXTERNAL TABLE
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï: INSERT INTO staging.web_logs_staging SELECT * FROM ...
    
    GET DIAGNOSTICS v_rows_count = ROW_COUNT;
    
    -- 3. –ü–û–î–°–ß–ï–¢ –û–¢–ö–õ–û–ù–ï–ù–ù–´–• –°–¢–†–û–ö
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ gp_read_error_log
    
    v_end_time := clock_timestamp();
    
    -- 4. –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
    INSERT INTO audit.load_history 
        (table_name, source_file, rows_loaded, rows_rejected, 
         load_start, load_end, load_duration, status)
    VALUES 
        ('staging.web_logs_staging', p_source_file, v_rows_count, v_reject_count,
         v_start_time, v_end_time, v_end_time - v_start_time, 
         CASE WHEN v_reject_count = 0 THEN 'SUCCESS' ELSE 'PARTIAL' END);
    
    RETURN QUERY SELECT v_rows_count, v_reject_count, 'SUCCESS'::TEXT;
END;
$$ LANGUAGE plpgsql;
```

### 2.4 Data Quality Checks

–†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö:

```sql
CREATE OR REPLACE FUNCTION staging.validate_web_logs()
RETURNS TABLE(
    check_name TEXT,
    check_result TEXT,
    issue_count INTEGER,
    details TEXT
) AS $$
BEGIN
    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: NULL –≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª—è—Ö
    RETURN QUERY
    SELECT 
        'NULL values in required fields'::TEXT,
        CASE WHEN count(*) = 0 THEN 'PASS' ELSE 'FAIL' END::TEXT,
        count(*)::INTEGER,
        'Found ' || count(*) || ' rows with NULL in timestamp or response_code'
    FROM staging.web_logs_staging
    WHERE timestamp IS NULL OR response_code IS NULL;
    
    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP –∫–æ–¥—ã
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    
    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    
    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –î—É–±–ª–∏–∫–∞—Ç—ã log_id
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    
    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ 5: –ê–Ω–æ–º–∞–ª—å–Ω–æ –≤—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (> 10000 ms)
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    
END;
$$ LANGUAGE plpgsql;

-- –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫
SELECT * FROM staging.validate_web_logs();

-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ audit
INSERT INTO audit.data_quality_checks (table_name, check_name, check_result, issue_count, check_details)
SELECT 'staging.web_logs_staging', check_name, check_result, issue_count, details
FROM staging.validate_web_logs();
```

### 2.5 –ü–µ—Ä–µ–Ω–æ—Å –≤ Production

```sql
-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
CREATE OR REPLACE FUNCTION staging.promote_web_logs_to_production()
RETURNS INTEGER AS $$
DECLARE
    v_rows_count INTEGER;
BEGIN
    -- –í—Å—Ç–∞–≤–∫–∞ –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    INSERT INTO production.web_logs
    SELECT * FROM staging.web_logs_staging
    WHERE timestamp IS NOT NULL
        AND response_code IS NOT NULL
        AND response_code BETWEEN 100 AND 599
        AND response_time_ms >= 0
    ON CONFLICT (log_id) DO NOTHING;  -- –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
    
    GET DIAGNOSTICS v_rows_count = ROW_COUNT;
    
    -- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    ANALYZE production.web_logs;
    
    RETURN v_rows_count;
END;
$$ LANGUAGE plpgsql;

-- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
SELECT staging.promote_web_logs_to_production();
```

**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:**
1. –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –±—ã–ª–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ?
2. –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –±—ã–ª–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ? –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏?
3. –ö–∞–∫–æ–µ –≤—Ä–µ–º—è –∑–∞–Ω—è–ª–∞ –∑–∞–≥—Ä—É–∑–∫–∞?
4. –ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç data skew —É —Ç–∞–±–ª–∏—Ü—ã?

---

## –ó–∞–¥–∞–Ω–∏–µ 3: –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (JSON) (25 –º–∏–Ω—É—Ç)

### 3.1 –î–∏–∑–∞–π–Ω —Ç–∞–±–ª–∏—Ü

–°–æ–±—ã—Ç–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```json
{
    "event_id": "evt_123456",
    "user_id": 1001,
    "event_type": "screen_view",
    "timestamp": "2024-11-14T10:00:00Z",
    "device": {
        "platform": "iOS",
        "version": "17.0",
        "model": "iPhone 14"
    },
    "properties": {
        "screen_name": "ProductDetails",
        "product_id": 456,
        "time_spent": 45
    }
}
```

**–ó–∞–¥–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π:

```sql
-- Staging: —Å—ã—Ä–æ–π JSON
CREATE TABLE staging.app_events_staging (
    event_id TEXT,
    event_json JSONB,
    loaded_at TIMESTAMP DEFAULT now()
) DISTRIBUTED BY (event_id);

-- Production: –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
CREATE TABLE production.app_events (
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–¢–†–£–ö–¢–£–†–£ –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    -- –ü–æ–ª—è: event_id, user_id, event_type, timestamp, 
    --        platform, device_version, device_model,
    --        properties (JSONB –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏)
) DISTRIBUTED BY (?)
PARTITION BY RANGE (timestamp)
(
    -- –ü–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞ 7 –¥–Ω–µ–π
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
-- –°–û–ó–î–ê–ô–¢–ï GIN –∏–Ω–¥–µ–∫—Å –Ω–∞ properties
-- –°–û–ó–î–ê–ô–¢–ï B-tree –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è
```

### 3.2 –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ JSON

```sql
-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ NDJSON —Ñ–∞–π–ª–∞
CREATE OR REPLACE FUNCTION staging.load_app_events(
    p_source_file TEXT
) RETURNS INTEGER AS $$
DECLARE
    v_rows_count INTEGER;
BEGIN
    -- –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è raw JSON
    CREATE TEMP TABLE temp_json_import (json_line TEXT);
    
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï: –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ —Ñ–∞–π–ª–∞ –≤ temp_json_import
    
    -- –ü–∞—Ä—Å–∏–Ω–≥ JSON –∏ –≤—Å—Ç–∞–≤–∫–∞ –≤ staging
    INSERT INTO staging.app_events_staging (event_id, event_json)
    SELECT 
        json_line::JSONB->>'event_id' as event_id,
        json_line::JSONB
    FROM temp_json_import
    WHERE json_line IS NOT NULL;
    
    GET DIAGNOSTICS v_rows_count = ROW_COUNT;
    
    DROP TABLE temp_json_import;
    
    RETURN v_rows_count;
END;
$$ LANGUAGE plpgsql;
```

### 3.3 –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ Production

```sql
-- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –≤ production
INSERT INTO production.app_events 
    (event_id, user_id, event_type, timestamp, 
     platform, device_version, device_model, properties)
SELECT 
    event_json->>'event_id',
    (event_json->>'user_id')::INTEGER,
    event_json->>'event_type',
    (event_json->>'timestamp')::TIMESTAMP,
    event_json->'device'->>'platform',
    event_json->'device'->>'version',
    event_json->'device'->>'model',
    event_json->'properties'  -- –°–æ—Ö—Ä–∞–Ω—è–µ–º properties –∫–∞–∫ JSONB
FROM staging.app_events_staging
ON CONFLICT (event_id) DO NOTHING;
```

### 3.4 –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã

–ù–∞–ø–∏—à–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

```sql
-- 1. –¢–æ–ø-10 —ç–∫—Ä–∞–Ω–æ–≤ –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º
-- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û

-- 2. –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø–æ —Ç–∏–ø—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
-- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û

-- 3. –í–æ—Ä–æ–Ω–∫–∞: screen_view -> add_to_cart -> purchase
-- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û

-- 4. –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º
-- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
```

---

## –ó–∞–¥–∞–Ω–∏–µ 4: –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ ERP (XML) (25 –º–∏–Ω—É—Ç)

### 4.1 –î–∏–∑–∞–π–Ω —Ç–∞–±–ª–∏—Ü

XML —Ñ–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–∞—Ö:

```xml
<order>
    <order_id>ORD-1001</order_id>
    <customer>
        <id>5001</id>
        <name>John Smith</name>
        <email>john@example.com</email>
    </customer>
    <order_date>2024-11-14</order_date>
    <total>350.00</total>
    <items>
        <item>
            <sku>PROD-123</sku>
            <name>Laptop</name>
            <quantity>1</quantity>
            <price>300.00</price>
        </item>
        <item>...</item>
    </items>
</order>
```

**–ó–∞–¥–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–π—Ç–µ normalized —Ç–∞–±–ª–∏—Ü—ã:

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE production.orders (
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
) DISTRIBUTED BY (customer_id);

-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE production.order_items (
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
) DISTRIBUTED BY (order_id);
```

### 4.2 –ü–∞—Ä—Å–∏–Ω–≥ XML –∏ –∑–∞–≥—Ä—É–∑–∫–∞

```sql
-- Staging –¥–ª—è XML
CREATE TABLE staging.orders_xml (
    doc_id SERIAL PRIMARY KEY,
    xml_content XML,
    loaded_at TIMESTAMP DEFAULT now()
) DISTRIBUTED BY (doc_id);

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤
CREATE OR REPLACE FUNCTION staging.parse_and_load_orders()
RETURNS TABLE(orders_loaded INTEGER, items_loaded INTEGER) AS $$
DECLARE
    v_orders_count INTEGER;
    v_items_count INTEGER;
BEGIN
    -- –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤
    INSERT INTO production.orders (order_id, customer_id, customer_name, ...)
    SELECT 
        -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï: XPath –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        (xpath('/order/order_id/text()', xml_content))[1]::TEXT,
        ...
    FROM staging.orders_xml;
    
    GET DIAGNOSTICS v_orders_count = ROW_COUNT;
    
    -- –ó–∞–≥—Ä—É–∑–∫–∞ items
    WITH items_data AS (
        -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    )
    INSERT INTO production.order_items (order_id, sku, ...)
    SELECT ...
    FROM items_data;
    
    GET DIAGNOSTICS v_items_count = ROW_COUNT;
    
    RETURN QUERY SELECT v_orders_count, v_items_count;
END;
$$ LANGUAGE plpgsql;
```

---

## –ó–∞–¥–∞–Ω–∏–µ 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (30 –º–∏–Ω—É—Ç)

### 5.1 –°–æ–∑–¥–∞–Ω–∏–µ consolidated view

–û–±—ä–µ–¥–∏–Ω–∏—Ç–µ –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö:

```sql
CREATE VIEW production.customer_360 AS
SELECT 
    c.customer_id,
    c.customer_name,
    c.email,
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ web_logs
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ app_events
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ orders
FROM ...;
```

### 5.2 –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á–µ—Ç–æ–≤

**–û—Ç—á–µ—Ç 1: Daily Sales Dashboard**
```sql
CREATE VIEW production.daily_sales_dashboard AS
-- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
-- –î–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å: –¥–∞—Ç–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤, —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂, 
-- —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
;
```

**–û—Ç—á–µ—Ç 2: User Engagement Metrics**
```sql
CREATE VIEW production.user_engagement_metrics AS
-- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
-- –î–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å: user_id, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π,
-- –≤—Ä–µ–º—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, RFM —Å–µ–≥–º–µ–Ω—Ç
;
```

### 5.3 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ó–∞–¥–∞–Ω–∏–µ:** –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ:

1. **Data Skew:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ production —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ data skew
-- –ï—Å–ª–∏ skew > 10%, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ
```

2. **–ò–Ω–¥–µ–∫—Å—ã:**
```sql
-- –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ:
-- - –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö WHERE conditions
-- - JOIN –∫–ª—é—á–µ–π
-- - –ö–æ–ª–æ–Ω–æ–∫ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
```

3. **Compression:**
```sql
-- –ü—Ä–∏–º–µ–Ω–∏—Ç–µ column-oriented compression
ALTER TABLE production.web_logs SET WITH (appendonly=true, compresstype=zstd);
-- –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
```

---

## –ó–∞–¥–∞–Ω–∏–µ 6: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ, 30 –º–∏–Ω—É—Ç)

### 6.1 –°–æ–∑–¥–∞–Ω–∏–µ master –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–π –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

```sql
CREATE OR REPLACE FUNCTION staging.run_daily_load()
RETURNS TABLE(
    step TEXT,
    status TEXT,
    details TEXT
) AS $$
BEGIN
    -- –®–∞–≥ 1: Web Logs
    BEGIN
        PERFORM staging.load_web_logs('web_logs_daily.csv');
        RETURN QUERY SELECT 'Web Logs', 'SUCCESS', 'Loaded';
    EXCEPTION WHEN OTHERS THEN
        RETURN QUERY SELECT 'Web Logs', 'FAILED', SQLERRM;
    END;
    
    -- –®–∞–≥ 2: App Events
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    
    -- –®–∞–≥ 3: Orders
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    
    -- –®–∞–≥ 4: Data Quality Checks
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    
    -- –®–∞–≥ 5: Promotion to Production
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    
END;
$$ LANGUAGE plpgsql;
```

### 6.2 –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–æ–∫
CREATE TABLE audit.incremental_load_state (
    table_name TEXT PRIMARY KEY,
    last_loaded_timestamp TIMESTAMP,
    last_loaded_id BIGINT
) DISTRIBUTED RANDOMLY;

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
CREATE OR REPLACE FUNCTION staging.incremental_load_web_logs()
RETURNS INTEGER AS $$
-- –†–ï–ê–õ–ò–ó–£–ô–¢–ï: –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ —Å timestamp > last_loaded_timestamp
$$ LANGUAGE plpgsql;
```

---

## –ó–∞–¥–∞–Ω–∏–µ 7: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ, 20 –º–∏–Ω—É—Ç)

### 7.1 Dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–∞–≥—Ä—É–∑–æ–∫

```sql
CREATE VIEW audit.load_dashboard AS
SELECT 
    table_name,
    count(*) as total_loads,
    count(*) FILTER (WHERE status = 'SUCCESS') as successful_loads,
    count(*) FILTER (WHERE status = 'FAILED') as failed_loads,
    sum(rows_loaded) as total_rows_loaded,
    sum(rows_rejected) as total_rows_rejected,
    avg(EXTRACT(EPOCH FROM load_duration)) as avg_load_time_seconds,
    max(load_end) as last_load_time
FROM audit.load_history
WHERE load_start >= current_date - interval '7 days'
GROUP BY table_name;
```

### 7.2 Alerts –¥–ª—è –ø—Ä–æ–±–ª–µ–º

```sql
-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–Ω–æ–º–∞–ª–∏–π
CREATE OR REPLACE FUNCTION audit.check_load_anomalies()
RETURNS TABLE(
    alert_type TEXT,
    table_name TEXT,
    issue TEXT
) AS $$
BEGIN
    -- –ê–ª–µ—Ä—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –±–æ–ª–µ–µ 24 —á–∞—Å–æ–≤
    RETURN QUERY
    SELECT 
        'MISSING_LOAD'::TEXT,
        t.table_name,
        'Last load was ' || (now() - max(lh.load_end))::TEXT || ' ago'
    FROM (VALUES ('production.web_logs'), ('production.app_events'), ('production.orders')) t(table_name)
    LEFT JOIN audit.load_history lh ON lh.table_name = t.table_name
    GROUP BY t.table_name
    HAVING max(lh.load_end) < now() - interval '24 hours' OR max(lh.load_end) IS NULL;
    
    -- –ê–ª–µ—Ä—Ç 2: –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç rejected —Å—Ç—Ä–æ–∫
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    
    -- –ê–ª–µ—Ä—Ç 3: –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å
    -- –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
    
END;
$$ LANGUAGE plpgsql;

-- –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
SELECT * FROM audit.check_load_anomalies();
```

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å (70 –±–∞–ª–ª–æ–≤):

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ë–∞–ª–ª—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ | 15 | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, constraints, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ |
| –ó–∞–≥—Ä—É–∑–∫–∞ CSV —Ä–∞–±–æ—Ç–∞–µ—Ç | 15 | –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ |
| –ó–∞–≥—Ä—É–∑–∫–∞ JSON —Ä–∞–±–æ—Ç–∞–µ—Ç | 15 | JSON –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è |
| –ó–∞–≥—Ä—É–∑–∫–∞ XML —Ä–∞–±–æ—Ç–∞–µ—Ç | 15 | XML –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è |
| Data Quality –ø—Ä–æ–≤–µ—Ä–∫–∏ | 10 | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å (30 –±–∞–ª–ª–æ–≤):

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ë–∞–ª–ª—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è | 10 | Master –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ |
| –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ | 5 | –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ |
| –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | 10 | Data skew < 10%, –∏–Ω–¥–µ–∫—Å—ã, compression |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | 5 | Dashboard –∏ alerts |

### –ë–æ–Ω—É—Å–Ω—ã–µ –±–∞–ª–ª—ã (–¥–æ 20):

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–µ—à–µ–Ω–∏—è (+10)
- –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π (+5)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases (+5)

---

## Deliverables (–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–∞—Ç—å)

### 1. SQL —Å–∫—Ä–∏–ø—Ç—ã:
- `setup.sql` - —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∏ —Ñ—É–Ω–∫—Ü–∏–π
- `load_data.sql` - –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞ –∑–∞–≥—Ä—É–∑–æ–∫
- `analytics.sql` - –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏ views

### 2. –û—Ç—á–µ—Ç –≤ Markdown:
- –û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–µ—à–µ–Ω–∏—è
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ distribution keys
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã data quality –ø—Ä–æ–≤–µ—Ä–æ–∫
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏, data skew)
- –ü—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### 3. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –ú–∏–Ω–∏–º—É–º 3 —Ñ–∞–π–ª–∞ (CSV, JSON, XML)
- –û–±—â–∏–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö: 1000+ –∑–∞–ø–∏—Å–µ–π

### 4. –°–∫—Ä–∏–Ω—à–æ—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–æ–∫
- Dashboard –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- EXPLAIN ANALYZE –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

**Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è CSV:**
```python
import csv
import random
from datetime import datetime, timedelta

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 1000 —Å—Ç—Ä–æ–∫ web_logs
# –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
```

**Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è JSON:**
```python
import json
from datetime import datetime

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 1000 —Å–æ–±—ã—Ç–∏–π
# –†–ï–ê–õ–ò–ó–£–ô–¢–ï –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û
```

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π distribution key** ‚Üí data skew
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Üí –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
3. **–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ production** ‚Üí –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
4. **–ó–∞–±—ã–ª–∏ ANALYZE –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏** ‚Üí –ø–ª–æ—Ö–∏–µ –ø–ª–∞–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [GreenPlum Best Practices](https://docs.vmware.com/en/VMware-Greenplum/index.html)
- [PostgreSQL JSON Functions](https://www.postgresql.org/docs/9.4/functions-json.html)
- [XPath Tutorial](https://www.w3schools.com/xml/xpath_intro.asp)

---

## –°—Ä–æ–∫–∏ —Å–¥–∞—á–∏

**Deadline:** 7 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è

**–§–æ—Ä–º–∞—Ç —Å–¥–∞—á–∏:** 
- Pull request –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫—É—Ä—Å–∞
- –ò–ª–∏ zip –∞—Ä—Ö–∏–≤ —Å —Ñ–∞–π–ª–∞–º–∏ –Ω–∞ email –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è

---

## –í–æ–ø—Ä–æ—Å—ã?

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ FAQ –≤ README –∫—É—Ä—Å–∞
2. –°–ø—Ä–æ—Å–∏—Ç–µ –≤ —á–∞—Ç–µ –∫—É—Ä—Å–∞
3. –ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é

**–£–¥–∞—á–∏! üöÄ**